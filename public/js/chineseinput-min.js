!function(a){"use strict";var b,c="textarea-helper-caret",d="textarea-helper",e=["box-sizing","height","width","padding-bottom","padding-left","padding-right","padding-top","font-family","font-size","font-style","font-variant","font-weight","word-spacing","letter-spacing","line-height","text-decoration","text-indent","text-transform","direction"],f=function(b){("textarea"===b.nodeName.toLowerCase()||"input"===b.nodeName.toLowerCase())&&(this.$text=a(b),this.$mirror=a("<div/>").css({position:"absolute",overflow:"auto","white-space":"pre-wrap","word-wrap":"break-word",top:0,left:-9999}).insertAfter(this.$text))};b=function(){this.update=function(){var b,d,f,g,h,i,j,k={};for(b=0;b<e.length;b++)d=e[b],k[d]=this.$text.css(d);this.$mirror.css(k).empty(),f=this.getOriginalCaretPos(),g=this.$text.val(),h=document.createTextNode(g.substring(0,f)),i=document.createTextNode(g.substring(f)),j=a("<span/>").addClass(c).css("position","absolute").html("&nbsp;"),this.$mirror.append(h,j,i).scrollTop(this.$text.scrollTop())},this.destroy=function(){return this.$mirror.remove(),this.$text.removeData(d),null},this.caretPos=function(){this.update();var a=this.$mirror.find("."+c),b=a.position();return"rtl"===this.$text.css("direction")&&(b.right=this.$mirror.innerWidth()-b.left-a.width(),b.left="auto"),b},this.height=function(){return this.update(),this.$mirror.css("height",""),this.$mirror.height()},this.getOriginalCaretPos=function(){var a,b,c,d=this.$text[0];return d.selectionStart?d.selectionStart:document.selection?(d.focus(),a=document.selection.createRange(),null===a?0:(b=d.createTextRange(),c=b.duplicate(),b.moveToBookmark(a.getBookmark()),c.setEndPoint("EndToStart",b),c.text.length)):0}},b.call(f.prototype),a.fn.textareaHelper=function(b){if(this.each(function(){var b=a(this),c=b.data(d);c||(c=new f(this),b.data(d,c))}),b){var c=this.first().data(d);return c[b]()}return this}}(jQuery),function(a){"use strict";a.chinesePinyinInput=function(b,c){var d=this;d.$el=a(b),d.el=b,c&&"object"==typeof c||(c={}),d.init=function(){d.conf=a.extend(!0,{},c),d.active=!0,d.pinyinInput="",d.currentPage=0,d.chosenCandidateIndex=1,d.lastPage=!1,d.hanzis=[],d.lens=[],d.wordpinyin="",d.$el.keydown(d.keydownHandler),d.$el.keypress(d.keypressHandler)},d.addTxtAtCusor=function(a){var b,c,e,f;document.selection?(d.el.focus(),b=document.selection.createRange(),b.text=a,d.el.focus()):d.el.selectionStart||"0"===d.el.selectionStart?(c=d.el.selectionStart,e=d.el.selectionEnd,f=d.el.scrollTop,d.el.value=d.el.value.substring(0,c)+a+d.el.value.substring(e,d.el.value.length),d.el.focus(),d.el.selectionStart=c+a.length,d.el.selectionEnd=c+a.length,d.el.scrollTop=f):(d.el.value+=a,d.el.focus())},d.checkPinyinInput=function(){return d.active===!0},d.setPinyinInput=function(a){d.active=a===!0},d.hasPinyinInput=function(){return d.pinyinInput.length>0},d.keydownHandler=function(b){if(!d.checkPinyinInput())return!0;if(d.hasPinyinInput())switch(b.which){case a.ui.keyCode.LEFT:return d.prevCandidate(),!1;case a.ui.keyCode.RIGHT:return d.nextCandidate(),!1;case a.ui.keyCode.PAGE_UP:return d.prevPage(),!1;case a.ui.keyCode.PAGE_DOWN:return d.nextPage(),!1;case a.ui.keyCode.BACKSPACE:return d.pinyinInput=d.pinyinInput.substring(0,d.pinyinInput.length-1),d.refresh(),b.preventDefault(),!1;default:return!0}return!0},d.keypressHandler=function(b){if(!d.checkPinyinInput())return!0;if(/[a-zA-Z]/.test(String.fromCharCode(b.which)))return d.pinyinInput.length<=20&&(d.pinyinInput+=String.fromCharCode(b.which)),d.refresh(),b.preventDefault(),!1;if(d.hasPinyinInput()){switch(b.which){case a.ui.keyCode.SPACE:d.chooseCandidate(d.chosenCandidateIndex-1);break;case 49:d.chooseCandidate(0);break;case 50:d.chooseCandidate(1);break;case 51:d.chooseCandidate(2);break;case 52:d.chooseCandidate(3);break;case 53:d.chooseCandidate(4);break;case a.ui.keyCode.ENTER:d.addTxtAtCusor(d.pinyinInput),d.pinyinInput="",d.currentPage=0,d.chosenCandidateIndex=1,d.lastPage=!1}return d.refresh(),b.preventDefault(),!1}return!0},d.nextPage=function(){d.lastPage||(d.currentPage+=1,d.refresh())},d.prevPage=function(){d.currentPage>0&&(d.currentPage-=1,d.lastPage=!1,d.refresh())},d.nextCandidate=function(){d.chosenCandidateIndex<5?(d.chosenCandidateIndex+=1,d.refresh()):(d.chosenCandidateIndex=1,d.nextPage())},d.prevCandidate=function(){d.chosenCandidateIndex>1?(d.chosenCandidateIndex-=1,d.refresh()):d.currentPage>0&&(d.chosenCandidateIndex=5,d.prevPage())},d.chooseCandidate=function(a){var b,c,e=d.hanzis;a+=5*d.currentPage,0>a&&(d.addTxtAtCusor(d.pinyinInput),d.pinyinInput="",d.currentPage=0,d.chosenCandidateIndex=1,d.lastPage=!1),e&&a<e.length&&(b=e[a],c=d.lens[a],d.addTxtAtCusor(b),d.pinyinInput=c&&c>0&&d.pinyinInput.length>c?d.pinyinInput.substring(c):"",d.currentPage=0,d.chosenCandidateIndex=1,d.lastPage=!1,d.hanzis=[],d.lens=[],d.wordpinyin="")},d.getPinyinBar=function(){var b=a("#draggableCadidates");return b.size()||(b=a(document.createElement("div")).draggable().attr({id:"draggableCadidates"}).html('<span class="pinyin"></span><ul class="candidates"></ul>'),a("body").append(b)),b},d.refresh=function(){if(!d.hasPinyinInput())return a("#draggableCadidates").hide(),void 0;var b,c,e,f,g=d.getCandidates();if(g&&g.length){for(b=d.getPinyinBar(),b.find(".pinyin").text(d.pinyinInput),c=[],e=0;5>e&&e<g.length;e++)c.push("<li "+(e+1===d.chosenCandidateIndex?'class="current"':"")+"> "+(e+1)+". "+g[e]+"</li>");b.find("ul").html(c.join("\n")),b.show(),f=d.$el.textareaHelper("caretPos"),b.css({position:"absolute",left:d.$el.offset().left+f.left,top:d.$el.offset().top+f.top})}else d.requestPinyinCandiates(d.pinyinInput,d.currentPage)},d.getCandidates=function(){if(d.pinyinInput.length!==d.wordpinyin.length)return!1;var a=d.hanzis;return a&&a.length>=5*(d.currentPage+1)?a.slice(5*d.currentPage,5*(d.currentPage+1)):a&&a[a.length-1]===d.pinyinInput?(d.lastPage=!0,a.slice(5*d.currentPage)):!1},d.requestPinyinCandiates=function(b,c){var e=10+10*parseInt(Math.floor(c/2),10);a.get("http://www.google.com/inputtools/request?ime=pinyin&ie=utf-8&oe=utf-8&app=translate&uv",{text:b,num:e},function(a){d.parseData(a)})},d.parseData=function(a){var b,c,e;if("string"==typeof a&&(a=JSON.parse(a)),b=a[1][0],d.wordpinyin=b[0],c=b[1],d.lens=b[2],void 0===d.lens)for(d.lens=[],d.lens.length=c.length,e=0;e<d.lens.length;e++)d.lens[e]=d.wordpinyin.length;d.hanzis=c,d.refresh()},d.init()},a.fn.chinesePinyinInput=function(b){return this.each(function(){var c=new a.chinesePinyinInput(this,b);a(this).data("ChinesePinyinInput",c)})}}(jQuery);
//# sourceMappingURL=build/chineseinput/chineseinput_map.js